<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ——ä¸Šã’ã‚²ãƒ¼ãƒ </title>
  <style>
    :root {
      --red: #e63946;
      --white: #f5f5f5;
      --bg: #0b132b;
      --panel: #1c2541;
      --text: #f0f4f8;
      --accent: #3a86ff;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Noto Sans JP", system-ui, -apple-system, sans-serif;
      background: radial-gradient(circle at 20% 20%, rgba(58, 134, 255, 0.2), transparent 35%),
        radial-gradient(circle at 80% 0%, rgba(230, 57, 70, 0.15), transparent 30%),
        var(--bg);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .app {
      width: min(960px, 100%);
      background: rgba(28, 37, 65, 0.92);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
      padding: 24px;
    }

    h1 {
      margin: 0 0 12px;
      letter-spacing: 0.04em;
      font-size: 28px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    h1 span {
      font-size: 24px;
    }

    .description {
      margin: 0 0 20px;
      line-height: 1.7;
      color: rgba(240, 244, 248, 0.85);
      font-size: 15px;
    }

    .board {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .panel {
      background: rgba(9, 12, 23, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 16px;
      min-height: 180px;
    }

    .panel h2 {
      margin: 0 0 8px;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
      letter-spacing: 0.02em;
    }

    .command {
      font-size: 28px;
      font-weight: 700;
      letter-spacing: 0.08em;
      margin: 12px 0 6px;
      color: #ffbe0b;
    }

    .countdown {
      font-size: 18px;
      color: rgba(240, 244, 248, 0.8);
    }

    .status {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .status-card {
      padding: 12px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .status-card strong {
      display: block;
      font-size: 13px;
      color: rgba(240, 244, 248, 0.75);
      margin-bottom: 6px;
      letter-spacing: 0.03em;
    }

    .status-value {
      font-size: 22px;
      font-weight: 700;
    }

    .flags {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-top: 6px;
    }

    .flag {
      width: 120px;
      height: 140px;
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      padding: 12px;
      position: relative;
      overflow: hidden;
    }

    .flag::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.08), transparent 45%);
      pointer-events: none;
    }

    .flag .label {
      font-size: 14px;
      color: rgba(240, 244, 248, 0.8);
      letter-spacing: 0.05em;
    }

    .flag .pole {
      position: absolute;
      bottom: 12px;
      left: 18px;
      width: 6px;
      height: 110px;
      background: linear-gradient(180deg, #d9d9d9, #a2a2a2);
      border-radius: 3px;
    }

    .flag .cloth {
      position: absolute;
      left: 24px;
      width: 80px;
      height: 54px;
      background: var(--white);
      border-radius: 8px 8px 10px 8px;
      box-shadow: 0 10px 18px rgba(0, 0, 0, 0.25);
      transition: transform 0.35s ease, background 0.35s ease;
      transform-origin: 6px 50%;
    }

    .flag.red .cloth {
      background: var(--red);
    }

    .flag.raised .cloth {
      transform: translateY(-54px) rotate(-3deg);
    }

    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 10px;
      margin-top: 14px;
    }

    button {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.05);
      color: var(--text);
      font-size: 15px;
      letter-spacing: 0.02em;
      cursor: pointer;
      transition: transform 0.1s ease, border-color 0.2s ease, background 0.2s ease;
    }

    button:hover:not(:disabled) {
      transform: translateY(-1px);
      border-color: rgba(255, 255, 255, 0.2);
      background: rgba(58, 134, 255, 0.15);
    }

    button:disabled {
      opacity: 0.55;
      cursor: not-allowed;
    }

    .primary {
      background: linear-gradient(90deg, #3a86ff, #4cc9f0);
      color: #0b132b;
      font-weight: 700;
      box-shadow: 0 10px 24px rgba(74, 144, 226, 0.35);
      border: none;
    }

    .message {
      margin-top: 10px;
      padding: 12px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      min-height: 52px;
      line-height: 1.6;
      font-weight: 600;
    }

    .success-bar {
      height: 10px;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.08);
      overflow: hidden;
      margin-top: 8px;
    }

    .success-bar span {
      display: block;
      height: 100%;
      background: linear-gradient(90deg, #06d6a0, #8ef6e4);
      width: 0;
      transition: width 0.3s ease;
    }

    @media (max-width: 720px) {
      .board {
        grid-template-columns: 1fr;
      }

      .command {
        font-size: 24px;
      }

      .flags {
        gap: 12px;
      }
    }
  </style>
</head>
<body>
  <main class="app">
    <h1>æ——ä¸Šã’ã‚²ãƒ¼ãƒ  <span>ğŸŒ</span></h1>
    <p class="description">
      5ç§’ã”ã¨ã«è¡¨ç¤ºã•ã‚Œã‚‹æŒ‡ç¤ºã«åˆã‚ã›ã¦ã€èµ¤æ——ã¨ç™½æ——ã‚’ä¸Šã’ä¸‹ã’ã™ã‚‹ã‚²ãƒ¼ãƒ ã§ã™ã€‚<br />
      æŒ‡ç¤ºãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹ç¬é–“ã®æ——ã®çŠ¶æ…‹ã§æˆå¦ã‚’åˆ¤å®šã—ã€30å›é€£ç¶šã§æˆåŠŸã™ã‚‹ã¨ã‚¯ãƒªã‚¢ã«ãªã‚Šã¾ã™ã€‚é€”ä¸­ã§ä¸€åº¦ã§ã‚‚é–“é•ãˆã‚‹ã¨ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã§ã™ã€‚
    </p>

    <div class="board">
      <section class="panel">
        <h2>ç¾åœ¨ã®æŒ‡ç¤º ğŸ“¢</h2>
        <div class="command" id="command">ã‚²ãƒ¼ãƒ é–‹å§‹ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>
        <div class="countdown">æ®‹ã‚Š <span id="countdown">5</span> ç§’</div>
        <div class="status">
          <div class="status-card">
            <strong>æˆåŠŸæ•°</strong>
            <div class="status-value"><span id="success">0</span> / 30</div>
            <div class="success-bar"><span id="successBar"></span></div>
          </div>
          <div class="status-card">
            <strong>çŠ¶æ…‹</strong>
            <div class="status-value" id="gameState">å¾…æ©Ÿä¸­</div>
          </div>
          <div class="status-card">
            <strong>å‰å›ã®çµæœ</strong>
            <div class="status-value" id="lastResult">-</div>
          </div>
        </div>
      </section>

      <section class="panel">
        <h2>æ——ã®æ“ä½œ ğŸ®</h2>
        <div class="flags">
          <div class="flag red" id="redFlag">
            <div class="label">èµ¤æ——</div>
            <div class="pole"></div>
            <div class="cloth"></div>
          </div>
          <div class="flag" id="whiteFlag">
            <div class="label">ç™½æ——</div>
            <div class="pole"></div>
            <div class="cloth"></div>
          </div>
        </div>
        <div class="controls">
          <button id="raiseRed">èµ¤ã‚’ä¸Šã’ã‚‹</button>
          <button id="lowerRed">èµ¤ã‚’ä¸‹ã’ã‚‹</button>
          <button id="raiseWhite">ç™½ã‚’ä¸Šã’ã‚‹</button>
          <button id="lowerWhite">ç™½ã‚’ä¸‹ã’ã‚‹</button>
          <button class="primary" id="start">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
          <button id="reset">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
        <div class="message" id="message">æ——ã‚’ä¸Šã’ãŸã‚Šä¸‹ã’ãŸã‚Šã—ã¦æŒ‡ç¤ºã‚’å¾…ã¡ã¾ã—ã‚‡ã†ã€‚</div>
      </section>
    </div>
  </main>

  <script>
    const commandElement = document.getElementById("command");
    const countdownElement = document.getElementById("countdown");
    const successElement = document.getElementById("success");
    const successBar = document.getElementById("successBar");
    const gameStateElement = document.getElementById("gameState");
    const lastResultElement = document.getElementById("lastResult");
    const messageElement = document.getElementById("message");
    const redFlag = document.getElementById("redFlag");
    const whiteFlag = document.getElementById("whiteFlag");

    const commands = [
      { text: "èµ¤ã‚ã’ã¦", check: (state) => state.redRaised },
      { text: "èµ¤ã•ã’ã¦", check: (state) => !state.redRaised },
      { text: "ç™½ã‚ã’ã¦", check: (state) => state.whiteRaised },
      { text: "ç™½ã•ã’ã¦", check: (state) => !state.whiteRaised },
    ];

    let gameInterval = null;
    let remainingTime = 5;
    let successes = 0;
    let currentCommand = null;
    let status = "ready"; // ready | running | over | clear

    const flagState = {
      redRaised: false,
      whiteRaised: false,
    };

    function setFlag(flag, raised) {
      flagState[flag] = raised;
      const target = flag === "redRaised" ? redFlag : whiteFlag;
      target.classList.toggle("raised", raised);
    }

    function pickCommand() {
      if (!currentCommand) return commands[Math.floor(Math.random() * commands.length)];
      let next;
      do {
        next = commands[Math.floor(Math.random() * commands.length)];
      } while (next === currentCommand);
      return next;
    }

    function updateDisplay() {
      countdownElement.textContent = remainingTime;
      successElement.textContent = successes;
      successBar.style.width = `${(successes / 30) * 100}%`;
      gameStateElement.textContent =
        status === "ready"
          ? "å¾…æ©Ÿä¸­"
          : status === "running"
          ? "é€²è¡Œä¸­"
          : status === "over"
          ? "ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼"
          : "ã‚¯ãƒªã‚¢";
    }

    function setCommand(command) {
      currentCommand = command;
      commandElement.textContent = command.text;
      lastResultElement.textContent = successes === 0 ? "-" : lastResultElement.textContent;
    }

    function showMessage(text) {
      messageElement.textContent = text;
    }

    function evaluate() {
      if (!currentCommand) return;
      const success = currentCommand.check(flagState);
      if (success) {
        successes += 1;
        lastResultElement.textContent = "æˆåŠŸ";
        if (successes >= 30) {
          status = "clear";
          stopGame();
          showMessage("ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼30å›é€£ç¶šæˆåŠŸã§ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸã€‚ãƒªã‚»ãƒƒãƒˆã—ã¦ã‚‚ã†ä¸€åº¦éŠã¹ã¾ã™ã€‚");
          commandElement.textContent = "ã‚¯ãƒªã‚¢ï¼";
          updateDisplay();
          return;
        }
        startRound("æˆåŠŸã—ã¾ã—ãŸã€‚æ¬¡ã®æŒ‡ç¤ºã«å‚™ãˆã¾ã—ã‚‡ã†ã€‚");
      } else {
        status = "over";
        lastResultElement.textContent = "å¤±æ•—";
        commandElement.textContent = "ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼";
        stopGame();
        showMessage("æŒ‡ç¤ºã¨é•ã†æ——ã®çŠ¶æ…‹ã§ã—ãŸã€‚ãƒªã‚»ãƒƒãƒˆã—ã¦å†æŒ‘æˆ¦ã—ã¦ãã ã•ã„ã€‚");
      }
      updateDisplay();
    }

    function startRound(feedback = "") {
      if (status !== "running") return;
      remainingTime = 5;
      setCommand(pickCommand());
      if (feedback) {
        showMessage(feedback);
      } else {
        showMessage("5ç§’ä»¥å†…ã«æŒ‡ç¤ºé€šã‚Šã«æ——ã‚’ä¸Šã’ä¸‹ã’ã—ã¦ãã ã•ã„ã€‚");
      }
      updateDisplay();
      clearInterval(gameInterval);
      gameInterval = setInterval(() => {
        remainingTime -= 1;
        if (remainingTime <= 0) {
          evaluate();
        } else {
          updateDisplay();
        }
      }, 1000);
    }

    function startGame() {
      status = "running";
      successes = 0;
      lastResultElement.textContent = "-";
      setFlag("redRaised", false);
      setFlag("whiteRaised", false);
      showMessage("5ç§’é–“ã§æŒ‡ç¤ºé€šã‚Šã«æ——ã‚’å‹•ã‹ã—ã¦ãã ã•ã„ã€‚30å›æˆåŠŸã§ã‚¯ãƒªã‚¢ã§ã™ï¼");
      startRound();
    }

    function stopGame() {
      clearInterval(gameInterval);
      gameInterval = null;
      updateDisplay();
    }

    function resetGame() {
      status = "ready";
      successes = 0;
      currentCommand = null;
      remainingTime = 5;
      lastResultElement.textContent = "-";
      commandElement.textContent = "ã‚²ãƒ¼ãƒ é–‹å§‹ã‚’æŠ¼ã—ã¦ãã ã•ã„";
      showMessage("æ——ã‚’ä¸Šã’ãŸã‚Šä¸‹ã’ãŸã‚Šã—ã¦æŒ‡ç¤ºã‚’å¾…ã¡ã¾ã—ã‚‡ã†ã€‚");
      setFlag("redRaised", false);
      setFlag("whiteRaised", false);
      stopGame();
    }

    document.getElementById("raiseRed").addEventListener("click", () => {
      setFlag("redRaised", true);
    });

    document.getElementById("lowerRed").addEventListener("click", () => {
      setFlag("redRaised", false);
    });

    document.getElementById("raiseWhite").addEventListener("click", () => {
      setFlag("whiteRaised", true);
    });

    document.getElementById("lowerWhite").addEventListener("click", () => {
      setFlag("whiteRaised", false);
    });

    document.getElementById("start").addEventListener("click", () => {
      if (status === "running") return;
      startGame();
    });

    document.getElementById("reset").addEventListener("click", () => {
      resetGame();
    });

    resetGame();
  </script>
</body>
</html>
